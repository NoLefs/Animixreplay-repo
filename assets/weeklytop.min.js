document.addEventListener("DOMContentLoaded", () => {
  weeklyTop();
  weeklyTopExpanded();
});

function weeklyTop() {		
  fetch('https://cdn.animixreplay.to/' + btoa(encodeURIComponent(`https://api.myanimelist.net/v2/anime/ranking?ranking_type=airing&limit=10`)))
		.then((response) => response.json())
		.then((data) => {
			const ongoingplace = document.getElementById("ongoingplace");
      ongoingplace.innerHTML = "";  
			data.data.map((series) => {
				const link = document.createElement("a");
				link.href = "/anime/" + series.node.id;
				link.title = series.node.title;
				ongoingplace.appendChild(link);
				const topanime = document.createElement("li");
				topanime.className = "topanimeli topanimea";
				link.appendChild(topanime);
				const topanimeimg = document.createElement("img");
				topanimeimg.className = "topanimeimg";
				topanimeimg.src = series.node.main_picture.medium; 
				topanime.appendChild(topanimeimg);
				const topanimeDiv = document.createElement("div");
				topanime.appendChild(topanimeDiv);
				const topanimenumberDiv = document.createElement("div");
				topanimenumberDiv.className = "topanimenumber";
				topanimenumberDiv.textContent = "#" + series.ranking.rank;
				topanimeDiv.appendChild(topanimenumberDiv);
				const topanimename = document.createElement("span");
				topanimename.className = "topanimename";
				topanimename.textContent = series.node.title;
				topanimeDiv.appendChild(topanimename);
				const topanimeStats = document.createElement("div");
				topanimeStats.className = "topanimestats";
				topanimeDiv.appendChild(topanimeStats);
				const topanimeRating = document.createElement("div");
				topanimeRating.className = "topanimerating";
				// Rating Info Below //
				topanimeStats.appendChild(topanimeRating);
				const topanimeUser = document.createElement("div");
				topanimeUser.className = "topanimeuser";
				// User Info Below //
				topanimeStats.appendChild(topanimeUser);

				const malId = series.node.id;
				const url = 'https://cdn.animixreplay.to/' + btoa(encodeURIComponent(`https://api.myanimelist.net/v2/anime/${malId}?fields=mean,popularity,num_list_users,num_scoring_users`));
				
				fetch(url)					
					.then((response) => response.json())
					.then((data) => {
						rating = data.mean;
						users = data.num_list_users;

						if (rating == null) {
							topanimeRating.innerHTML = "<i class='glyphicon glyphicon-star'></i> ?";
						} else {
							topanimeRating.innerHTML = "<i class='glyphicon glyphicon-star'></i> " + rating;	
						}
						if (users == null) {
							topanimeUser.innerHTML = "<i class='glyphicon glyphicon-stats'></i> ?";

						} else {
							topanimeUser.innerHTML = "<i class='glyphicon glyphicon-stats'></i> " + users.toLocaleString("en-US");
						}
					});	
			});
		}); 
}

function weeklyTopExpanded() {	
	fetch('https://cdn.animixreplay.to/' + btoa(encodeURIComponent(`https://api.myanimelist.net/v2/anime/ranking?ranking_type=airing&limit=35`)))
		.then((response) => response.json())
		.then((data) => {
      const ongoingplace2 = document.getElementById("ongoingplace2");
      data.data.map((series) => {
          if (series.ranking.rank > 10) {
            const link = document.createElement("a");
            link.href = "/anime/" + series.node.id;
            link.title = series.node.title;
            ongoingplace2.appendChild(link);
            const topanime = document.createElement("li");
            topanime.className = "topanimeli topanimea";
            link.appendChild(topanime);
            const topanimeimg = document.createElement("img");
            topanimeimg.className = "topanimeimg";
            topanimeimg.src = series.node.main_picture.medium; 
            topanime.appendChild(topanimeimg);
            const topanimeDiv = document.createElement("div");
            topanime.appendChild(topanimeDiv);
            const topanimenumberDiv = document.createElement("div");
            topanimenumberDiv.className = "topanimenumber";
            topanimenumberDiv.textContent = "#" + series.ranking.rank;
            topanimeDiv.appendChild(topanimenumberDiv);
            const topanimename = document.createElement("span");
            topanimename.className = "topanimename";
            topanimename.textContent = series.node.title;
            topanimeDiv.appendChild(topanimename);
            const topanimeStats = document.createElement("div");
            topanimeStats.className = "topanimestats";
            topanimeDiv.appendChild(topanimeStats);
            const topanimeRating = document.createElement("div");
            topanimeRating.className = "topanimerating";
            // Rating Info Below //
            topanimeStats.appendChild(topanimeRating);
            const topanimeUser = document.createElement("div");
            topanimeUser.className = "topanimeuser";
            // User Info Below //
            topanimeStats.appendChild(topanimeUser);

            const malId = series.node.id;
            const url = 'https://cdn.animixreplay.to/' + btoa(encodeURIComponent(`https://api.myanimelist.net/v2/anime/${malId}?fields=mean,popularity,num_list_users,num_scoring_users`));
            
            fetch(url)					
              .then((response) => response.json())
              .then((data) => {
                rating = data.mean;
                users = data.num_list_users;

                if (rating == null) {
                  topanimeRating.innerHTML = "<i class='glyphicon glyphicon-star'></i> ?";
                } else {
                  topanimeRating.innerHTML = "<i class='glyphicon glyphicon-star'></i> " + rating;	
                }
                if (users == null) {
                  topanimeUser.innerHTML = "<i class='glyphicon glyphicon-stats'></i> ?";

                } else {
                  topanimeUser.innerHTML = "<i class='glyphicon glyphicon-stats'></i> " + users.toLocaleString("en-US");
                }
              });	
          };
			});
	}); 
}

function expandweekly() {	
  const reduceOnClick = document.getElementById("expandbtn2")
  reduceOnClick.setAttribute("onClick", "javascript: reduceweekly();");
  
  const expandbtn = document.getElementById("expandbtn2").querySelector("i");
  expandbtn.classList.replace('glyphicon-menu-down', 'glyphicon-menu-up');
  
  const ongoingVisible = document.getElementById("ongoingplace2");
  ongoingVisible.style.visibility = "visible";
  ongoingVisible.style.height = "2180px";
  $('html, body').animate({scrollTop: '+=2180px'}, 850);
}

function reduceweekly() {	
  const expandOnClick = document.getElementById("expandbtn2")
  expandOnClick.setAttribute("onClick", "javascript: expandweekly();");

  const reducebtn = document.getElementById("expandbtn2").querySelector("i");
  reducebtn.classList.replace('glyphicon-menu-up', 'glyphicon-menu-down');
  
  const ongoingHidden = document.getElementById("ongoingplace2");
  ongoingHidden.style.height = "0px";
  $('html, body').animate({scrollTop: '-=2180px'}, 300);
}